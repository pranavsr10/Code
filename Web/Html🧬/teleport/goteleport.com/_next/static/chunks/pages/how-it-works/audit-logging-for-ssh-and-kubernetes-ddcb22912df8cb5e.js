(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9347],{93957:function(e,s,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/how-it-works/audit-logging-for-ssh-and-kubernetes",function(){return n(60228)}])},60228:function(e,s,n){"use strict";n.r(s),n.d(s,{default:function(){return f},meta:function(){return x}});var t=n(52322),a=n(45392),i=n.p+"static/media/teleport-audit-log.94e205cf.png",r=n(32282),l=n(47361),c=n(96577),o=n.n(c),d=n(62230),h=n(85244),u=n(98240),j=n(52903),p=n(73447),m=function(e){var s=e.children;return(0,j.tZ)(p.Z,{flexDirection:["column","row"],width:"100%",mt:[0,5],children:s})};m.Item=function(e){var s=e.title,n=e.children,t=(0,u.Z)(e,["title","children"]);return(0,j.BX)(p.Z,(0,h.Z)((0,d.Z)({flexDirection:"column",width:["auto","50%"],alignItems:"flex-start",mx:3,mt:[3,0]},t),{children:[(0,j.tZ)(p.Z,{fontWeight:"bold",fontSize:"text-lg",mb:2,children:s}),(0,j.tZ)(p.Z,{color:"white",bg:"code",width:"100%",borderRadius:"default",children:n})]}))};var x={hideWave:!0,border:"none",h1:"Audit Logging",title:"Audit Logging for SSH and Kubernetes",description:"How to implement audit logging and session recording for SSH and Kubernetes access to improve visibility into your cloud infrastructure",headerTitle:"Audit Logging",headerDescription:"Learn how Teleport keeps an audit log of access events for all SSH servers, Kubernetes clusters, and web applications.",layout:"howItWorks"},g=function(e){return(0,t.jsx)(l.Z,Object.assign({},e,{meta:x}))};function b(e){var s=Object.assign({h2:"h2",p:"p",code:"code",ol:"ol",li:"li",strong:"strong",em:"em",a:"a",pre:"pre",span:"span",ul:"ul"},(0,a.ah)(),e.components);return m||N("SplitCode",!1),m.Item||N("SplitCode.Item",!0),(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(s.h2,{children:"The Basics"}),"\n",(0,t.jsxs)(s.p,{children:["As the ",(0,t.jsx)(s.code,{children:"teleport"})," daemon runs on every machine in a cluster, it detects security-related events and reports them to the cluster\u2019s auth service. Generally, there are three types of information that can be collected for audit purposes:"]}),"\n",(0,t.jsxs)(s.ol,{children:["\n",(0,t.jsxs)(s.li,{children:["\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.strong,{children:"Access events"}),".  These include security-related events that happen \u201con the wire,\u201d such as login attempts, remote command execution, access denied events, session creation, termination, etc.."]}),"\n"]}),"\n",(0,t.jsxs)(s.li,{children:["\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.strong,{children:"Session recordings"}),". When users create interactive sessions via ",(0,t.jsx)(s.code,{children:"ssh"})," or via ",(0,t.jsx)(s.code,{children:"kubectl exec -ti"}),", these sessions are recorded and can be replayed later via a Youtube-like web interface with features like pause, rewind, etc."]}),"\n"]}),"\n",(0,t.jsxs)(s.li,{children:["\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.strong,{children:"Host events"}),". This is also called ",(0,t.jsx)(s.em,{children:"enhanced session recording"}),". When enabled, host events allow Teleport to capture and store detailed low-level events that happen on a host during a user session, such as filesystem changes, network activity, process execution, etc. ",(0,t.jsx)(s.a,{href:"https://lwn.net/Articles/740157/",children:"eBPF"})," must be supported by the host kernel and ",(0,t.jsx)(s.a,{href:"https://github.com/iovisor/bcc",children:"BCC"})," must be installed for this to work."]}),"\n"]}),"\n"]}),"\n",(0,t.jsx)(s.p,{children:"The diagram below illustrates two options (A and B) for how audit data is collected and stored:"}),"\n",(0,t.jsx)(o(),{src:i,alt:"Audit Log",height:360,width:600}),"\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.strong,{children:"Option A"})," is called ",(0,t.jsx)(s.em,{children:"recording node"}),". In this mode, each Teleport node sends the audit information to the auth service. This is the default and recommended method."]}),"\n",(0,t.jsxs)(s.p,{children:[(0,t.jsx)(s.strong,{children:"Option B"})," is called ",(0,t.jsx)(s.em,{children:"recording proxy"}),". In this mode, the Teleport Proxy service is sending the audit information to the auth service regarding all client connections."]}),"\n",(0,t.jsx)(s.p,{children:"You can read about additional considerations for picking the audit recording method in the documentation."}),"\n",(0,t.jsx)(s.h2,{children:"Audit Format"}),"\n",(0,t.jsx)(s.p,{children:"Teleport uses two data formats for the audit information:"}),"\n",(0,t.jsxs)(s.ol,{children:["\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Security events"})," such as access events and host events are stored as structured JSON documents. ",(0,t.jsx)(s.a,{href:"/docs/setup/admin/",children:"Teleport documentation"})," better details their format. They are suitable for export and processing by external software."]}),"\n",(0,t.jsxs)(s.li,{children:[(0,t.jsx)(s.strong,{children:"Recorded sessions"})," contain the raw dump of stdout and stderr streams, including TAB characters (bash escape sequences). One can instantaneously replay a recorded session using cat command."]}),"\n"]}),"\n",(0,t.jsxs)(m,{children:[(0,t.jsx)(m.Item,{title:"Event Data Example",children:(0,t.jsx)(s.pre,{children:(0,t.jsxs)(s.code,{className:"hljs language-json",children:[(0,t.jsx)(s.span,{className:"hljs-punctuation",children:"{"}),"\n",(0,t.jsx)(s.span,{className:"hljs-attr",children:'"event"'}),(0,t.jsx)(s.span,{className:"hljs-punctuation",children:":"})," ",(0,t.jsx)(s.span,{className:"hljs-string",children:'"session.start"'}),(0,t.jsx)(s.span,{className:"hljs-punctuation",children:","}),"\n",(0,t.jsx)(s.span,{className:"hljs-attr",children:'"user"'}),(0,t.jsx)(s.span,{className:"hljs-punctuation",children:":"})," ",(0,t.jsx)(s.span,{className:"hljs-string",children:'"john.doe@example.com"'}),(0,t.jsx)(s.span,{className:"hljs-punctuation",children:","}),"\n",(0,t.jsx)(s.span,{className:"hljs-attr",children:'"login"'}),(0,t.jsx)(s.span,{className:"hljs-punctuation",children:":"})," ",(0,t.jsx)(s.span,{className:"hljs-string",children:'"dba"'}),(0,t.jsx)(s.span,{className:"hljs-punctuation",children:","}),"\n",(0,t.jsx)(s.span,{className:"hljs-attr",children:'"server_id"'}),(0,t.jsx)(s.span,{className:"hljs-punctuation",children:":"})," ",(0,t.jsx)(s.span,{className:"hljs-string",children:'"f84f7386-5e22"'}),(0,t.jsx)(s.span,{className:"hljs-punctuation",children:","}),"\n",(0,t.jsx)(s.span,{className:"hljs-attr",children:'"sid"'}),(0,t.jsx)(s.span,{className:"hljs-punctuation",children:":"})," ",(0,t.jsx)(s.span,{className:"hljs-string",children:'"8d3895b6-e9dd"'}),(0,t.jsx)(s.span,{className:"hljs-punctuation",children:","}),"\n",(0,t.jsx)(s.span,{className:"hljs-attr",children:'"addr.local"'}),(0,t.jsx)(s.span,{className:"hljs-punctuation",children:":"})," ",(0,t.jsx)(s.span,{className:"hljs-string",children:'"10.5.l.15"'}),(0,t.jsx)(s.span,{className:"hljs-punctuation",children:","}),"\n",(0,t.jsx)(s.span,{className:"hljs-attr",children:'"addr.remote"'}),(0,t.jsx)(s.span,{className:"hljs-punctuation",children:":"})," ",(0,t.jsx)(s.span,{className:"hljs-string",children:'"73.223.221.14"'}),(0,t.jsx)(s.span,{className:"hljs-punctuation",children:","}),"\n",(0,t.jsx)(s.span,{className:"hljs-attr",children:'"time"'}),(0,t.jsx)(s.span,{className:"hljs-punctuation",children:":"})," ",(0,t.jsx)(s.span,{className:"hljs-string",children:'"2017-02-03T06:54:05Z"'}),"\n",(0,t.jsx)(s.span,{className:"hljs-punctuation",children:"}"}),"\n"]})})}),(0,t.jsx)(m.Item,{title:"Recorded Session Data Example",children:(0,t.jsx)(s.pre,{children:(0,t.jsxs)(s.code,{className:"hljs language-go",children:["^[[",(0,t.jsx)(s.span,{className:"hljs-number",children:"94"}),";",(0,t.jsx)(s.span,{className:"hljs-number",children:"1"}),"msmb^[[",(0,t.jsx)(s.span,{className:"hljs-number",children:"0"}),";",(0,t.jsx)(s.span,{className:"hljs-number",children:"33"}),"m ~^[[",(0,t.jsx)(s.span,{className:"hljs-number",children:"00"}),"m: cd /usr/bin^M\n^[[",(0,t.jsx)(s.span,{className:"hljs-number",children:"94"}),";",(0,t.jsx)(s.span,{className:"hljs-number",children:"1"}),"msmb^[[",(0,t.jsx)(s.span,{className:"hljs-number",children:"0"}),";",(0,t.jsx)(s.span,{className:"hljs-number",children:"33"}),"m /usr/bin^[[",(0,t.jsx)(s.span,{className:"hljs-number",children:"00"}),"m: ls^M\n^[[",(0,t.jsx)(s.span,{className:"hljs-number",children:"94"}),";",(0,t.jsx)(s.span,{className:"hljs-number",children:"1"}),"msmb^[[",(0,t.jsx)(s.span,{className:"hljs-number",children:"0"}),";",(0,t.jsx)(s.span,{className:"hljs-number",children:"33"}),"m /usr/bin^[[",(0,t.jsx)(s.span,{className:"hljs-number",children:"00"}),"m: exit^M\nlogout^M\n\n\n\n\n\n\n"]})})})]}),"\n",(0,t.jsx)(s.h2,{children:"Recorded Sessions using"}),"\n",(0,t.jsx)(s.p,{children:"Here's what the session replay looks like:"}),"\n",(0,t.jsx)(o(),{src:r,alt:"How Teleport Works",height:360,width:600}),"\n",(0,t.jsx)(s.h2,{children:"Audit Storage"}),"\n",(0,t.jsx)(s.p,{children:"There are several options for storing audit information:"}),"\n",(0,t.jsxs)(s.ul,{children:["\n",(0,t.jsx)(s.li,{children:"Both the security events and session recordings can be stored on a file system available to the auth service. This is the simplest option."}),"\n",(0,t.jsx)(s.li,{children:"Security events can be stored in a cloud database such as DynamoDB, Google Firebase, and others."}),"\n",(0,t.jsx)(s.li,{children:"Session recordings can be stored in cloud blob storage such as Amazon S3."}),"\n"]}),"\n",(0,t.jsx)(s.p,{children:"Teleport audit information can easily be injected into external logging and monitoring facilities such as Splunk, AlertLogic, Elasticsearch, and others."})]})}var f=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return(0,t.jsx)(g,Object.assign({},e,{children:(0,t.jsx)(b,e)}))};function N(e,s){throw new Error("Expected "+(s?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}},32282:function(e,s,n){"use strict";e.exports=n.p+"static/media/recorded-session.42d639ca.gif"}},function(e){e.O(0,[4825,7388,9260,1839,4276,5746,7361,9774,2888,179],(function(){return s=93957,e(e.s=s);var s}));var s=e.O();_N_E=s}]);